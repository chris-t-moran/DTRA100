<!DOCTYPE html>
<html lang="en">
<head>
	
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTRA100 - 100 years of stories from the Drumcondra Triangle</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
	<link rel="icon" type="image/x-icon" href="https://www.drumcondratriangle.com/uploads/1/1/8/4/118430940/dtralogo_orig.png"> 
	<style>
	
	blockquote {
	  background: #f9f9f9 !important;
	  border-left: 2px solid #ccc !important;
	  margin: 0.5em 10px !important;
	  padding: 0.5em 10px !important;
	  quotes: "\201C""\201D""\2018""\2019" !important;
	  font-style:normal !important;
	  font-family: 'Arial', sans-serif !important; 
	}
	blockquote:before {
	  color: #ccc;
	  content: open-quote !important;
	  font-size: 4em !important;
	  line-height: 0.1em !important;
	  margin-right: 0.25em !important;
	  vertical-align: -0.4em !important;
	  font-style:normal !important;
	}
	blockquote p {
	  display: inline;
	}
	
	blockquote {
    margin: 10px 0;
    padding-left: 10px;
    border-left: 2px solid #ddd;
    font-style:normal;
    line-height: 130%;
	}
	

	.popup-box {
		width: 300px;
		height:150px;
		border: 0px solid #ccc;
		border-radius: 0px;
		overflow: hidden;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	}
	.popup-box img {
		width: 100%;
		height: auto;
	}
	.popup-box .title {
		padding: 0px;
		background-color: #f9f9f9;
	
	}
	
	ul {
    padding: 0;
	}
	
	#article-list{
	opacity:1;
	transition:opacity 0.3ease-in-out;
	}
	
	#article-list.fade{
	opacity:0;
	}
	
	#mainpage {
	display: flex;
    margin: 0;
    font-family: Moderat, sans-serif;
    flex-direction: row;
	}
	
		
	#content {
	display: flex;
    margin: 0;
    font-family: Moderat, sans-serif;
    flex-direction: column;

	
	}
	
	#intro {
    display: flex;
    margin: 0;
    font-family: Moderat, sans-serif;
    flex-direction: column;
	
	}
	
	#themes {
		width: 100%;
		background-color: #ffffff;
		
		margin-top: 20px;
		margin-bottom: 20px;
	}
		
		#themes .theme {
		display: inline-block;
		margin-right: 10px;
		padding: 5px 10px;
		background-color: #4CAF50;
		color: white;
		border-radius: 8px;
		cursor: pointer;
		}
		
		#themes .theme.active {
		background-color: #1cfc66;
		}
		
		#map{
		display: flex;
		flex: 1;
		flex-direction: row;
		}
		
		#article-list {
		opacity: 1;
		transition: opacity 0.35s ease-in-out;
	}

	.hidden {
		display: none;
	}
		
			
	
	#article-list {
		width: 100%;
		max-width: 570px;
		background-color: #ffffff;
		height:500px;
		padding-bottom:10px;
		flex-grow: 1;
		
	   
	}
	
	#article-list h2 {
		font-size: 1.5em;
		margin-top: 0;
		color: #4CAF50;
	}
	


	#article-list p {
		
		width: 100%;
		background-color: #ffffff;
		text-align: justify;
		height: auto;
		color: #4CAF50;
		border-radius: 8px;
		font-weight:100;
	}
	

	#article-list .grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
		gap: 10px;
		
	}
	


	#article-list .theme {
		margin-bottom: 20px;
	}
	#article-list .theme h3 {
		margin-top: 0;
		color: #555555;
	}
	#article-list .grid-container {
		display: grid;
		column-gap: 50px;
		grid-template-columns: 1fr 1fr 1fr;
		padding: 10px;
	}
	.article-list {
		display: none;
	}
	.article-list.active {
		display: block;
	}
	.card {
		position: relative;
		border: 1px solid #ddd;
		border-radius: 8px;
		overflow: hidden;
		box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		transition: transform 0.2s;
	}
	.card:hover {
		transform: scale(1.05);
	}
	.card img {
		width: 100%;
		height: 150px;
		object-fit: cover;
	}
	.card .overlay {
		position: absolute;
		bottom: 0;
		left: 0;
		width: 100%;
		background: #4CAF50;
		color: #fff;
		padding: 5px;
		text-align: center;
		font-size: 13px;
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
		letter-spacing: normal;
		word-spacing: normal;
	}
	
	
	.card .inactiveoverlay {
		position: absolute;
		bottom: 0;
		left: 0;
		width: 100%;
		background: red;
		color: #fff;
		padding: 5px;
		text-align: center;
		font-size: 13px;
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
		letter-spacing: normal;
		word-spacing: normal;
	}


		
	#footer{
	padding-top: 10px;
	padding-bottom:10px;
	}
	
	#footer img{
	height: 50%;
	width:50%;
	}
	
	#footer img{
	object-fit:contain;
	}
	
	#content{
	color: #4CAF50;
	font-weight:100;
	width: 100%;
    max-width: 570px;
    background-color: #ffffff;
	padding-right: 50px;
	padding-left: 80px;
	height:1000px;
	overflow-y:auto
	}
	
	#content h1 {
    color: #4CAF50;
    font-size: 35px;
    text-align: left;
	}
	
	#content h2 {
    color: #4CAF50;
    font-size: 1.5em;
	font-weight:bold;
    text-align: left;
	}
	


/* Optionally, add a crosshatch effect */
inactive {
    content: '';
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: repeating-linear-gradient(
        45deg,
        rgba(0, 0, 0, 0.2) 0,
        rgba(0, 0, 0, 0.2) 1px,
        transparent 1px,
        transparent 4px
    );
}
	


@media (max-width: 500px) {
	
	.leaflet-container {
		height: 250px !important; /* Ensure the Leaflet map fills its container */
		width: 100% !important; /* Ensure the Leaflet map fills the container */
	
		order:-1;
	}
	#content{
		order: 1; /* Display content below the map */
		width: 100%; /* Ensure it takes the full width */
		padding-left: 0px !important;
		padding-right: 0px !important;
		padding-top: 20px;
	}
	#mainpage{
		display:grid;
	}
	
	blockquote {
    margin: 10px 0;
    padding-left: 10px;
    border-left: 2px solid #ddd;
    /* font-style: italic; */
    line-height: 130%;
	}
	
	#themes .theme {
		font-weight:bold !important;
	}
	
	.card .overlay{
		font-weight:bold !important;
	}
	
	#content{
		font-weight:bold !important;
	}
	
	#article-list p{
	font-weight:bold !important;
	
	}
	
}




.modal {
  font-family: Moderat, sans-serif;
  -webkit-font-smoothing: antialiased;
  color: #4CAF50;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background-color: #ffffff;
  width: 90%;
  max-width: 500px;
  overflow-y:auto;
  border-radius: 10px;
  position: relative;
  text-align: center;
  transform: translateY(-30px);
  opacity: 0;
  transition: all 0.4s ease;
}


.modal.show .modal-content {
  transform: translateY(0);
  opacity: 1;
}

.modal-content img {
  background-color: #ffffff;
  height: 100%;
  width: auto;
  object-fit: contain;
}


/* Hide scrollbar but keep scroll */
.modal-content div::-webkit-scrollbar {
  display: none;
}

.descriptionWrapper {
 background-color: #ffffff;
  max-height: 300px;
  overflow-y: auto;
  margin-top: 20px;
  text-align: justify;
  scrollbar-width: none; /* Firefox */
}

.modal-content imgWrapper {
  background-color: #ffffff;
  max-height: 300px;
  text-align: justify;
  scrollbar-width: none; /* Firefox */
}

.descriptionWrapper::-webkit-scrollbar {
  width: 0px;
  background: transparent; /* Chrome/Safari */
  
}

img {
  opacity: 1;
  transition: opacity 0.4s ease;
}

.fade-out {
  opacity: 0;
  transition: opacity 0.3s ease;
}

.fade-in {
  opacity: 1;
  transition: opacity 0.4s ease;
}

.progress{
background-color: white;

}

.progress-bar {
  background-color:#4CAF50 ;
  position: sticky;   /* Stick to the top of the scrollable container */
  top: 0;
  left: 0;
  height: 4px;
  width: 0%;
  transition: width 0.25s ease;
  z-index: 1000; /* Make sure it stays on top */
  
}

.close-button {
  display: none;
}

.modal-content h2{
  font-size: 22px;
  margin: 0px 0 0px 0;
  text-align: center;
  padding-top: 10px;
  


}

.modal-content h3{
  font-size: 18px;
  margin: 0px 0 0px 0;
  text-align: center;
  padding-bottom: 5px;


}


.social-share-buttons {
  background-color: #ffffff;
  display: flex;
  justify-content: center;
  gap: 15px;
}

.social-share-buttons a {
  display: inline-block;
  padding: 10px;
  background-color: #3b5998; /* Facebook Blue */
  border-radius: 5px;
  color: white;
  text-decoration: none;
  font-size: 10px;
  transition: background-color 0.3s;
}

.social-share-buttons a.twitter {
  background-color: #00acee; /* Twitter Blue */
}

.social-share-buttons a.linkedin {
  background-color: #0077b5; /* LinkedIn Blue */
}

.social-share-buttons a:hover {
  opacity: 0.8;
}

.residents-toggle-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 60px;
  height: 30px;
  background-color: #add8e6;
  color: #000;
  border: 1px solid #666;
  border-radius: 4px;
  
  font-size: 14px;
  text-align: center;
  cursor: pointer;
  text-decoration: none;
}

.leaflet-container .leaflet-popup-content-wrapper {
  background-color: #4CAF50 !important;
  opacity: 0.9;
}


#map {
  transition: filter 0.5s ease-in-out;
}

#map.sepia {
  filter: sepia(.6);
}


.leaflet-marker-icon {
  opacity: 0;
  animation: fadeInMarker 0.8s ease-in-out forwards ;
}



@keyframes fadeInMarker {
  to {
    opacity: 1;
  }
}

	
	</style>
	
	</head>	
	
<body>

	<div id = "mainpage">
	
		
		<div id = "content">
		
			<div id="head_logo">
				<table>
					<tr>	
						<td><a href="https://drumcondratriangle.com/dtra100" class="icon"><img src="https://www.drumcondratriangle.com/uploads/1/1/8/4/118430940/hardiman-lampost-transparent2_orig.png" alt="Hardiman Road Lamppost Icon to Homepage" style="width:150px;height:150px;"></a></td>
						<td><h1>Triangle 100</h1></td>
					</tr>
				</table>
			</div>
		
			<div id = "intro">
				<br>
				<h2><blockquote>History is inclined to focus on the extraordinary, but the extraordinary is <i>only</i> extraordinary.<br><br>The ordinary, because it leaves no trace behind it, is precious.</h2></blockquote><i>Dermot Bolger (Ferguson Road, Sunday Press 1991)</i>
				<p>
				<p style="text-align:justify;">
				Welcome to this celebration of one of Ireland's first social housing estates. In the lead up to 2028, the Drumcondra Scheme's centenary year, local citizen historians (or neighbours as they are also known!) continue the task of discovering more about our communities's rich history, it's people and their <i>ordinary</i> lives. 
				<p style="text-align:justify;">
				We hope to exhibit the influence of it's residents over last 100 years upon the Drumcondra Triangle, a place we are all proud to call home.
			
				<h1>Click on the map, or search below to explore.</h1> 
			
			</div>
			
			<div id = "themes"></div>
			<button id="share-story-btn" class="theme" style="margin-top: 1.5em; padding: 0.75em 1.5em; background-color: orange; color: white; border: none; border-radius: 6px; cursor: pointer;">Get Involved and Share Your Story!</button>

			<div id = "article-list">
				<div id = "article-select"></div>
			</div>
			
			
		




		
		
		
		
		
		<script type="module">	
		// Define custom icons for different themes
		var icons = {};		
		 // Define articles with coordinates, images, and themes
        var articles = [];
		
		let map;
		let peopleMarkers = [];
		let markers = [];
		let articleMarkers = [];
		
		
		// Initialize Supabase
		console.log("Initializing")
		import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
		const supabaseUrl = "https://vqkoapgiozhytoqscxxx.supabase.co";
		const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZxa29hcGdpb3poeXRvcXNjeHh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU2NjEzMjIsImV4cCI6MjA2MTIzNzMyMn0.z4h2_uY-VlprsvaRZElh3ZOiGHG-fpGHO5rd7Y2nssY";
		const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
		
		
			

		// Load articles from Supabase
		async function loadArticles() {
			let { data, error } = await supabaseClient
				.from('articles')
				.select('*')
				.eq('active', true); // Only fetch active articles

			if (error) {
				console.error('Error fetching articles:', error);
				return;
			}

			articles = data;
			initMapAndPage(); 
		}
// --------------------
// Map and Page Setup
// --------------------
async function initMapAndPage() {
    const icons = {
        Default: L.icon({
            iconUrl: 'https://www.drumcondratriangle.com/uploads/1/1/8/4/118430940/geometric-circle-dot-shape-with-ring-pattern_orig.png',
            iconSize: [20, 20],
            iconAnchor: [0, 0],
            popupAnchor: [0, 0]
        })
    };

    map = L.map('map').setView([53.373, -6.259], 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);
	
	const ResidentsToggleControl = L.Control.extend({
  options: {
    position: 'topright' // topright, topleft, bottomright, bottomleft
  },

  onAdd: function () {
    const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');

    const button = L.DomUtil.create('a', '', container);
	button.className = 'residents-toggle-btn';
    button.href = '#';
    button.innerHTML = 'Switch to 1929'; // optional emoji or text
    button.title = 'Show/Hide First Residents';
    button.style.display = 'flex';
//button.style.alignItems = 'center';
//button.style.justifyContent = 'center';
button.style.width = '150px';  // adjust size as needed
button.style.height = '30px';
button.style.background = '#4CAF50';
button.style.border = '1px solid gold';
button.style.borderRadius = '4px';
button.style.color = 'white';
button.style.fontWeight = 'bold';
button.style.textAlign = 'center';
button.style.cursor = 'pointer';

    L.DomEvent.on(button, 'click', function (e) {
      L.DomEvent.stopPropagation(e);
      L.DomEvent.preventDefault(e);
      togglePeopleMarkers(button);
    });

    return container;
  }
});

map.addControl(new ResidentsToggleControl());
	
	
	articleMarkers = L.markerClusterGroup({
    // Optional: customize cluster options if needed
    maxClusterRadius: 40,
    showCoverageOnHover: false,
    spiderfyOnMaxZoom: true,
});
	
	
	

    const themesDiv = document.getElementById('themes');
    if (!themesDiv) {
        console.error("Element with ID 'themes' not found in the DOM.");
        return;
    }

    const themes = {};
    
    //let peopleMarkers = [];
    let peopleVisible = false;

    articles.forEach(article => {
    themes[article.theme] = themes[article.theme] || [];
    themes[article.theme].push(article);

    

    const circleMarker = L.circleMarker([article.lat, article.lon], {
        radius: 6,
        color: '#4CAF50', // or set based on theme
        fillColor: '#4CAF50	',
        fillOpacity: 0.8,
        weight: 1,
    });

   circleMarker.on('click', () => openModal(article));


    articleMarkers.addLayer(circleMarker);
});

map.addLayer(articleMarkers);

    

    // --- Themes / Categories ---
    let activeTheme = null;
    Object.keys(themes).forEach(theme => {
        const categoryItem = document.createElement('div');
        categoryItem.className = 'theme';
        categoryItem.textContent = theme;

        categoryItem.onclick = () => {
            if (activeTheme === theme) {
                activeTheme = null;
                filterArticlesByCategory(null);
                setActiveCategory(null);
            } else {
                activeTheme = theme;
                filterArticlesByCategory(theme);
                setActiveCategory(theme);
            }
        };
        themesDiv.appendChild(categoryItem);
    });

    // --- Lucky Dip ---
    const randomItem = document.createElement('div');
    randomItem.className = 'theme';
    randomItem.textContent = 'Lucky Dip!';
    randomItem.style.background = 'gold';
    randomItem.onclick = () => {
        activeTheme = null;
        filterArticlesByCategory('Random');
        setActiveCategory(null);
    };
    themesDiv.appendChild(randomItem);

    filterArticlesByCategory(null);
	await loadResidents();
}


  // Function to set the active category
    function setActiveCategory(theme) {
        var items = document.querySelectorAll('#themes .theme');
        items.forEach(item => item.classList.remove('active'));

        if (theme) {
            var activeItem = Array.from(items).find(item => item.textContent === theme);
            if (activeItem) activeItem.classList.add('active');
        }
    }

function togglePeopleMarkers(button) {

document.getElementById('map').classList.toggle('sepia');
  const isVisible = peopleMarkers.length > 0 && map.hasLayer(peopleMarkers[0]);

  if (isVisible) {
    // Hide people markers, show article markers
    peopleMarkers.forEach(marker => map.removeLayer(marker));
    if (articleMarkers) map.addLayer(articleMarkers);

    button.innerHTML = 'Switch to 1929';
  } else {
    // Hide article markers, show people markers
    if (articleMarkers) map.removeLayer(articleMarkers);
    peopleMarkers.forEach(marker => marker.addTo(map));

    button.innerHTML = 'Switch to Stories';
  }
}



async function loadResidents() { 
  const { data: residents, error } = await supabaseClient
    .from('residents')
    .select('*')
    .eq('active', true);

  if (error) {
    console.error('Error fetching residents:', error);
    return;
  }

  // set the residents markers and bind the resident popup
  residents.forEach((resident, i) => {
    const marker = L.circleMarker([resident.lat, resident.lon], {
      radius: 7,
      fillColor: '#4CAF50',
      color: 'gold',
      weight: 1,
      opacity: 0,         // Start invisible
      fillOpacity: 0      // Also start fill invisible
    })
    .bindPopup(`
      <div style="padding: 0px; background: #4CAF50;"><h2 style="color: white;">
      <h3 style="color: white;">A Triangle 100 First Resident <p>${resident.housenumber} ${escapeHTML(resident.road)}</h3></div>
      <div style="background: #4CAF50; color:white;">	  
        <strong>Name : </strong>${escapeHTML(resident.lessee)}<p>
        Occupation according to the original 1929 lease : <strong>${escapeHTML(resident.occupation)}</strong><br>
      </div>
    `);

    peopleMarkers.push(marker); // don't add to map yet

    // Add marker to map and fade in
    //marker.addTo(map);

    setTimeout(() => {
      marker.setStyle({ opacity: 1, fillOpacity: 1 });
    }, 50 + i * 30); // stagger slightly
  });
}


// Escape HTML (for security)
function escapeHTML(str) {
    if (!str) return '';
    return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}


function filterArticlesByCategory(theme) {
    var articleSelect = document.getElementById('article-select');
    articleSelect.innerHTML = '';

    if (theme && theme.toLowerCase() === 'random') {
        // Pick a random article and open its modal
        const randomArticle = articles[Math.floor(Math.random() * articles.length)];
        openModal(randomArticle);
        //return; // Exit early, don't build the grid
    }

    // Treat empty string or "all" as "no filter"
    var filteredArticles = (!theme || theme.toLowerCase() === 'all' || theme.toLowerCase() === 'random') 
        ? articles 
        : articles.filter(a => a.theme === theme);

    var grid = document.createElement('ul');
    grid.className = 'grid';

    filteredArticles.forEach(article => {
        var listItem = document.createElement('li');
        listItem.className = 'card';

        var link = document.createElement('a');
        link.href = 'javascript:void(0);';
        link.addEventListener('click', () => openModal(article));

        link.innerHTML = `
            <img src="${article.img}" alt="${article.title}"/>
            <div class="${article.active ? 'overlay' : 'inactiveoverlay'}">${article.title}</div>
        `;

        listItem.appendChild(link);
        grid.appendChild(listItem);
    });

    articleSelect.appendChild(grid);
}


window.openModal = function(article) {
    // Create modal background
    const modal = document.createElement('div');
    modal.className = 'modal'; // no .show yet

    // Create modal content
    const content = document.createElement('div');
    content.className = 'modal-content';

    // Close button
    const closeButton = document.createElement('span');
    closeButton.className = 'close-button';
    closeButton.innerHTML = '&times;';
    closeButton.onclick = () => document.body.removeChild(modal);

const headerSection = document.createElement('div');

headerSection.style.padding = '0px';
headerSection.style.background = '#4CAF50';

const title = document.createElement('h2');
title.textContent = article.title || '';
title.style.color = '#ffffff'; // white text on green

const shortDesc = document.createElement('h3');
shortDesc.textContent = article.short_desc || '';
shortDesc.style.color = '#ffffff';
shortDesc.style.backgroundColor = '#4CAF50'; 

headerSection.appendChild(title);
headerSection.appendChild(shortDesc);



	// Main Image block (wrapper)
const imgWrapper = document.createElement('div');
imgWrapper.style.width = '100%';       // Full width of modal (or set to a fixed width if needed)
imgWrapper.style.height = '300px';     // Fixed height for consistency
imgWrapper.style.overflow = 'hidden';  // Hide overflow for smooth zoom effect
imgWrapper.style.marginTop = '0px';
//imgWrapper.style.borderRadius = '8px';
imgWrapper.style.display = 'flex';
imgWrapper.style.alignItems = 'center';
imgWrapper.style.justifyContent = 'center';
imgWrapper.style.backgroundColor = '#f9f9f9'; // Optional background for smaller images
imgWrapper.style.position = 'relative'; // Required for child image positioning

// Image
const image = document.createElement('img');
image.src = article.img || '';
image.alt = article.title || '';
image.style.width = '100%';
image.style.height = '100%';
image.style.objectFit = 'contain'; 
image.style.transition = 'transform 0.5s ease'; // Smooth zoom transition
image.style.borderRadius = '8px';

// Zoom-in on hover
imgWrapper.onmouseover = () => {
  image.style.transform = 'scale(1.1)'; // Slight zoom-in
};
imgWrapper.onmouseout = () => {
  image.style.transform = 'scale(1)'; // Reset zoom
};

imgWrapper.appendChild(image);




    // Main Description with scrollable box
    const descriptionWrapper = document.createElement('div');
		
    descriptionWrapper.style.background = '#ffffff';
    descriptionWrapper.style.maxHeight = '200px';
    descriptionWrapper.style.overflowY = 'auto';
    //descriptionWrapper.style.marginTop = '10px';
    descriptionWrapper.style.textAlign = 'justify';
    //descriptionWrapper.style.padding = '0 5px';
    descriptionWrapper.style.scrollbarWidth = 'none'; // Firefox
    descriptionWrapper.style.msOverflowStyle = 'none'; // IE/Edge
	

	
	// Create progress bar
	const progressBar = document.createElement('div');
	progressBar.classList.add('progress-bar');
	progressBar.style.position = 'sticky';
	progressBar.style.top = '0';
	progressBar.style.left = '0';
	progressBar.style.height = '8px';
	progressBar.style.backgroundColor = '#4CAF50';
	
	//progressBar.style.background = '#4CAF50';
	progressBar.style.width = '0%';
	//progressBar.style.borderRadius = '2px';
	progressBar.style.transition = 'width 0.25s ease';
	progressBar.style.zIndex = '1000';
	//progressBar.style.marginBottom = '8px';
	//progressBar.style.marginTop = '8px';

	// Add progress bar to descriptionWrapper
	//descriptionWrapper.appendChild(progressBar);

	// Scroll event listener
	descriptionWrapper.addEventListener('scroll', () => {
	  const scrollTop = descriptionWrapper.scrollTop;
	  const scrollHeight = descriptionWrapper.scrollHeight - descriptionWrapper.clientHeight;
	  const scrollPercent = (scrollTop / scrollHeight) * 100;
	  progressBar.style.width = scrollPercent + '%';
	});


    const description = document.createElement('div');
	description.style.background = '#ffffff';
	description.style.padding = '25px 25px';
    description.innerHTML = (article.description || '').replace(/\n/g, '<br>');
    descriptionWrapper.appendChild(description);
	
	// Social Media Share Buttons
    const socialButtons = document.createElement('div');
    socialButtons.className = 'social-share-buttons';

    // Facebook
    const fbButton = document.createElement('a');
    fbButton.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`;
    fbButton.target = '_blank';
    fbButton.className = 'facebook';
    fbButton.innerHTML = 'Facebook';
    socialButtons.appendChild(fbButton);

    // Twitter
    const twitterButton = document.createElement('a');
    twitterButton.href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(window.location.href)}&text=${encodeURIComponent(article.title)}`;
    twitterButton.target = '_blank';
    twitterButton.className = 'twitter';
    twitterButton.innerHTML = 'Twitter';
    socialButtons.appendChild(twitterButton);


    // Contributor footer
    const footer = document.createElement('footer');
	footer.style.background = '#4CAF50';
	footer.style.color = '#ffffff';
    footer.style.fontSize = '1.0em';
	footer.style.height = '20px';
    footer.textContent = `Shared by: ${article.contributor || ''}`;

    // Assemble everything
    content.appendChild(closeButton);
    content.appendChild(headerSection);
	content.appendChild(shortDesc);
    content.appendChild(imgWrapper);
	content.appendChild(progressBar);
    content.appendChild(descriptionWrapper);
	//content.appendChild(socialButtons);
    content.appendChild(footer);

     modal.appendChild(content);
    document.body.appendChild(modal);

setTimeout(() => {
    modal.classList.add('show'); // This triggers the CSS animation
}, 100);

    modal.onclick = (e) => {
        if (e.target === modal) {
            document.body.removeChild(modal);
        }
    };
	

	// --- Image swap on scroll ---
descriptionWrapper.addEventListener('scroll', () => {
    const markers = descriptionWrapper.querySelectorAll('.image-change');
    let lastPassed = null;

    markers.forEach(marker => {
        const rect = marker.getBoundingClientRect();
        const wrapperRect = descriptionWrapper.getBoundingClientRect();
        if (rect.top - wrapperRect.top <= 50) {
            lastPassed = marker;
        }
    });

    if (lastPassed) {
        const newImg = lastPassed.getAttribute('data-img');
        if (newImg && image.src !== newImg) {
            // Step 1: Fade out
            image.classList.add('fade-out');

            // Step 2: After fade-out duration, change image src
            setTimeout(() => {
                image.src = newImg;

                // Step 3: Wait a tiny bit to ensure browser registers the src change
                setTimeout(() => {
                    image.classList.remove('fade-out');
                    image.classList.add('fade-in');
                }, 50); // a very short delay
            }, 300); // Matches fade-out timing

            // Step 4: Clean up the fade-in class after animation
            setTimeout(() => {
                image.classList.remove('fade-in');
            }, 700); // 300ms fade out + 400ms fade in
        }
    }
});
	
};


function showStoryFormPage() {
	window.scrollTo(0, 0);
    // Replace map with an image
    const mapDiv = document.getElementById('map');
    mapDiv.innerHTML = ''; // Clear map
    const img = document.createElement('img');
    img.src = 'https://www.drumcondratriangle.com/uploads/1/1/8/4/118430940/lillian-37walshroad-1937_orig.jpg'; // Replace with a local history-themed image
    img.style.width = '100%';
    img.style.height = '100%';
    img.style.objectFit = 'cover';
    mapDiv.appendChild(img);

    
const container = document.getElementById("content");

  container.innerHTML = `
  
  <table>
				<tr>	
					<td><a href="https://drumcondratriangle.com/dtra100" class="icon"><img src="https://www.drumcondratriangle.com/uploads/1/1/8/4/118430940/hardiman-lampost-transparent2_orig.png" alt="Hardiman Road Lamppost Icon to Homepage" style="width:150px;height:150px;"></a></td>
					<td><h1>Triangle 100</h1></td>
				</tr>
		</table>
		
		<div id = "story-share">
				<h2>Share Your Story!</h2> 
				<p style="text-align:justify;">
				We hope you are enjoying some of the wonderful stories that have been discovered about our neighbourhood. Behind every hall door there is a story to share so please get involved and share your memories of the people, places and things that make the Drumcondra Triangle such a wonderful place to live.
				
		</div>
  
  
  <div id="submission-form" style="max-width: 600px; padding: 2em; border: 1px solid #ccc; border-radius: 12px; background-color: #f9f9f9; font-family: sans-serif;">

    <form id="story-form">
	  <label for="title" style="display:block; margin-top: 1em;">Story Title:</label>
      <input name="title" placeholder="eg. Life on O'Daly Road" required style="width: 100%; padding: 0.5em; border-radius: 6px; border: 1px solid #aaa;" />
	  
	  <label for="contributor" style="display:block; margin-top: 1em;">Your Email Address:</label>
      <input name="contributor" placeholder="eg.  harry@brainesgarages.com" style="width: 100%; padding: 0.5em; border-radius: 6px; border: 1px solid #aaa;"/>
	  	  
	  <label for="description" style="display:block; margin-top: 1em;">Your Story:</label>
      <textarea name="description" placeholder="Your memories of people, places, traditions and memorable events." required style="width: 100%; padding: 0.5em; border-radius: 6px; border: 1px solid #aaa;"></textarea>
	  
	  
	  
      <button type="submit" style="margin-top: 1.5em; padding: 0.75em 1.5em; background-color: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer;">Submit</button>
      <button id="back-button" type="button" style="margin-top: 1.5em; padding: 0.75em 1.5em; background-color: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer;">Back</button>
    </form>
	
	</div>
  `;

  // Now that the back button is in the DOM, attach the listener:
  const form = document.getElementById("story-form");
  const backButton = document.getElementById("back-button");

  if (backButton) {
    backButton.addEventListener("click", () => {
      window.location.replace(window.location.pathname);
    });
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const title = form.title.value.trim();
    const description = form.description.value.trim();
    const contributor = form.contributor.value.trim();

    const { error } = await supabaseClient.from('articles').insert([
      {
        title,
        description,
        short_desc: description.slice(0, 100) + '...',
        contributor,
        active: false
      }
    ]);

    if (error) {
      alert('Error submitting your story. Please try again.');
    } else {
      alert('Thank you for your story! It will be reviewed and added soon.');
      location.href = location.href;
      window.scrollTo(0, 0);
    }
  });


    //articleSelect.appendChild(form);
}




// Start the app
loadArticles();
document.getElementById('share-story-btn').addEventListener('click', showStoryFormPage);




	</script>
	
	</div>
		
		
	
	
	<div id = "map">		
		<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
		<!-- MarkerCluster JS -->
		<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script> 
		
		<!-- Leaflet CSS (already needed for maps) -->
		<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

		<!-- MarkerCluster CSS -->
		<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
		<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

			
	</div>	

		
	</div>

</body>


	
			

</html>
